<!--pages/cart/cart.wxml-->
<wxs module="util">
  var toFixed = function(num, digits) {
    return Number(num).toFixed(digits || 2)
  }
  module.exports = {
    toFixed: toFixed
  }
</wxs>

<view class="container">
  <view class="page-title">购物车</view>

  <!-- 购物车列表 -->
  <view wx:if="{{cartList.length > 0}}" class="cart-content">
    <view class="cart-list">
      <view wx:for="{{cartList}}" wx:key="id" class="cart-item">
        <view class="item-header">
          <view class="item-info">
            <view class="item-name">{{item.name}}</view>
            <view class="item-price">¥{{item.price}}</view>
          </view>
          
          <view 
            class="btn-delete" 
            data-id="{{item.id}}"
            bindtap="handleDeleteItem"
          >
            删除
          </view>
        </view>
        
        <view class="item-actions">
          <view class="quantity-control">
            <view 
              class="btn-minus" 
              data-id="{{item.id}}"
              bindtap="handleReduceQuantity"
            >
              -
            </view>
            <text class="quantity">{{item.quantity}}</text>
            <view 
              class="btn-plus" 
              data-id="{{item.id}}"
              bindtap="handleAddQuantity"
            >
              +
            </view>
          </view>
          
          <view class="item-subtotal">
            小计：¥{{util.toFixed(item.price * item.quantity, 2)}}
          </view>
        </view>
      </view>
    </view>

    <!-- 备注 -->
    <view class="remark-section card">
      <view class="section-title">订单备注</view>
      <textarea 
        class="remark-input" 
        placeholder="请输入备注信息（选填）"
        value="{{remark}}"
        bindinput="handleRemarkInput"
        maxlength="200"
      ></textarea>
    </view>

    <!-- 底部操作栏 -->
    <view class="cart-footer">
      <view class="total-info">
        <text class="total-label">合计：</text>
        <text class="total-price">¥{{totalPrice}}</text>
        <text class="total-count">（共{{totalCount}}件）</text>
      </view>
      
      <view class="footer-actions">
        <button 
          class="btn-clear" 
          bindtap="handleClearCart"
        >
          清空购物车
        </button>
        <button 
          class="btn-submit" 
          type="primary"
          loading="{{submitting}}"
          disabled="{{submitting}}"
          bindtap="handleSubmitOrder"
        >
          提交订单
        </button>
      </view>
    </view>
  </view>

  <!-- 空状态 -->
  <view wx:else class="empty-state">
    <text class="empty-text">购物车空空如也</text>
    <button class="btn-go-shopping" bindtap="onBackToHome">
      去逛逛
    </button>
  </view>
</view>

