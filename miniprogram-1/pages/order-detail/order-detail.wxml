<!--pages/order-detail/order-detail.wxml-->
<view class="container">
  <view wx:if="{{loading}}" class="loading">
    <text>加载中...</text>
  </view>

  <view wx:elif="{{order}}" class="order-detail">
    <!-- 订单状态 -->
    <view class="status-section card">
      <view class="status-text">
        <text wx:if="{{order.status === 1}}">等待支付</text>
        <text wx:elif="{{order.status === 2}}">支付成功</text>
        <text wx:elif="{{order.status === 3}}">配送中</text>
        <text wx:elif="{{order.status === 4}}">订单完成</text>
        <text wx:elif="{{order.status === 5}}">订单已取消</text>
      </view>
    </view>

    <!-- 订单信息 -->
    <view class="info-section card">
      <view class="section-title">订单信息</view>
      <view class="info-item">
        <text class="label">订单号</text>
        <text class="value">{{order.order_no}}</text>
      </view>
      <view class="info-item">
        <text class="label">下单时间</text>
        <text class="value">{{order.created_at}}</text>
      </view>
      <view class="info-item" wx:if="{{order.remark}}">
        <text class="label">备注</text>
        <text class="value">{{order.remark}}</text>
      </view>
    </view>

    <!-- 商品列表 -->
    <view class="items-section card">
      <view class="section-title">商品清单</view>
      <view class="item-list">
        <view 
          wx:for="{{order.items}}" 
          wx:key="id" 
          class="item-row"
        >
          <view class="item-info">
            <text class="item-name">{{item.dish_name}}</text>
            <text class="item-price">¥{{item.dish_price}}</text>
          </view>
          <view class="item-quantity">×{{item.quantity}}</view>
          <view class="item-subtotal">¥{{item.subtotal}}</view>
        </view>
      </view>
    </view>

    <!-- 费用明细 -->
    <view class="price-section card">
      <view class="price-row">
        <text class="label">商品总价</text>
        <text class="value">¥{{order.total_price}}</text>
      </view>
      <view class="price-row total">
        <text class="label">实付金额</text>
        <text class="value">¥{{order.total_price}}</text>
      </view>
    </view>

    <!-- 操作按钮 -->
    <view class="actions-section">
      <button class="btn-contact" bindtap="handleContactMerchant">
        联系商家
      </button>
      
      <!-- 管理员操作 -->
      <button 
        wx:if="{{isAdmin && order.status < 4 && order.status !== 5}}"
        class="btn-admin-action"
        bindtap="handleUpdateStatus"
      >
        更新订单状态
      </button>
      
      <!-- 用户操作 -->
      <button 
        wx:if="{{!isAdmin && (order.status === 1 || order.status === 2)}}"
        class="btn-cancel" 
        bindtap="handleCancelOrder"
      >
        取消订单
      </button>
      <button 
        wx:if="{{!isAdmin && order.status === 1}}"
        class="btn-pay"
        bindtap="handlePay"
      >
        立即支付
      </button>
    </view>
  </view>

  <view wx:else class="empty-state">
    <text>订单不存在</text>
  </view>
</view>

